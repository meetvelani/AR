<script type="module" id="helmet"
  src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.0.1/model-viewer.min.js"></script>
<link rel="stylesheet" type="text/css" href="modelViewer.css" />


<model-viewer id="helmet" ar auto-rotate camera-controls touch-action="pan-y" src="./assets/ar-shop/d.glb"
  alt="A 3D model of a helmet" shadow-intensity="1" shadow-softness="1">



  <button slot="ar-button" class="custom-ar-btn"
    style="background-color: white; border-radius: 4px; border: none; position: absolute; right: 16px; ">
    <img
      src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEKklEQVR4nO2bx4sUQRTGf+7uxQDmXRU8KCp6FgRBPCkqIqLoQT0pCop6ETEfVkTwDxBkEc+iLhhvejCsmP4Bs2s4GDFgWGNLyddQ29ZMh+mp6dH+oGC6+tV7X72uV131phqyow1YB1wGPgCB5/JetteKi1e0A9ca0OlK5Sow2lfn26zOPwJWAMPwD2NzJdArLj1Aqw/D66zOm5HQaHRYTljjw+AVGTNPPg2uWkO2p0K9634SrFS7S3jAOxkbltFxgSYvV73rfhKMULu3eECgUjR44xWUDqDQxdsICP53BxQNpQMoRwBlCPAvxVpKlCFAGQI0TQiMBXYB91V2qa7RvOpqqAWYAxwHvjkWMD+A88DyjBmewjpgHLDH2rMHckA3ME+lO+KUXrUZV0deqTAVuAB8SWjIZGYWAqeA71YbM9x3AGMcbcbo3n1L/rt0LEyQ7QnbfBHXaeSEwcCTlGtue4//VcN+rsIgDi2SPa62oR6ThquGKL+n4l4zNknhLWB4QgdEY/sMsChhzq5VsmfUNqnTQ5mhwE393piinxXJPJCyJapLQ+Yo0Bd5Kp3AeEeb8br31JLvk440NhHXMORqSpQuk6K71vBNS8akq7cCtyOj4hywWOVc5GnfVpvRGW22iHOgPmTGNSlZX8FQEjI2pgNdwCdHzPYp7s2rckBCfdVkNujahEMmzJKCV8CgGslEMRLYYsltUV1WfS6ZgcBL1Zm+pMZpNe7MgYwPOZdMp+pOkhJTgJ96p3bkRKbeci4ZM4d8Bn6lXRd0SdmhHMnUW66SzKEqfXGiPcZrzeaAyVVGsxN7Y+Km2RyA+uKaz/7CIM361WbOZnRA+EZ7Hbc8Xi/B6zmR2RbzD3KcrnbpyMPprjVNP9irJ7Mnr4Qsm6FjKRY4AyR7LLIZivvDNI6Xa1XbD0sl8DBm/ZzEAZWSH2adf8DaC9i6zAS1PbId/pkiSRLHy/TpXmRf0w89urmZfOI2hElq7NaBirCtccoJ6/pExFGP1CbvhMjGSucPZujGG2BIDoZqTYll2cEl4WVP8jPtG92q3J+ToTiYBOhO4I7KTo9J0X2SM33+g4nyfl9CEnk4oB5Iyitc6Jn5ZZKpOKiGR3I25BtpeB2W7EFz8VwXs+tgyCfS8AoXRi/MxQ3HhJSkFA1Z+nAjnAPOAh//Iwd8VJ8n1GLIPucXfa82os7bgwkihlyGG1FXOoAGjYAebX5ocF3DHFAUlA6gHAGUIYDHWAsKWkoH1BtB+RagfA0GOYwkc+7nmRKlC5ppZAY5GbJPgjwpEK/EH02Z80JFcYDXj6auyJj5VK0WLJATTOfn16hrlc/P5tZahxkT/dtaZxgOj8VptQ+DbdbHjr3yfq3hkAXDZfux709nw5MX4T9JRSgmLEfhGa36VtfEXTgx+izG5kUN+8xP/jeg8acnYCjf2gAAAABJRU5ErkJggg==">
  </button>
  <div class="controls" ,="" id="color-controls">
    <button data-color="#ff0000">Red</button>
    <button data-color="#00ff00">Green</button>
    <button data-color="#0000ff">Blue</button>
  </div>

  <!-- <div class="controls">
    <div class="options">
      <div class="option " data-option="Plane032">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1376484/legs.svg" alt="" />
      </div>
      <div class="option" data-option="Object001">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1376484/cushions.svg" alt="" />
      </div>
      <div class="option" data-option="Object003">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1376484/base.svg" alt="" />
      </div>
      <div class="option" data-option="Object006">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1376484/supports.svg" alt="" />
      </div>
      <div class="option --is-active" data-option="all">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1376484/back.svg" alt="" />
      </div>
    </div>
  </div> -->
  <div id="js-tray" class="tray">
    <div id="js-tray-slide" class="tray__slide"></div>
  </div>
</model-viewer>
<!-- <script>
  
</script> -->

<script>
  const TRAY = document.getElementById('js-tray-slide');
  const modelViewerColor = document.querySelector("model-viewer#helmet");

  document.querySelector('#color-controls').addEventListener('click', (event) => {
    const colorString = event.target.dataset.color;
    const material = modelViewerColor.model.materials;
    console.log(material)
    console.log(modelViewerColor.model)
    material[2].pbrMetallicRoughness.setBaseColorFactor(colorString);
  });

  const colors = [
    {
      texture: 'img/wood_.jpg',
      size: [2, 2, 2],
      shininess: 60
    },

    {
      texture: 'img/fabric_.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_bump1.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_difuse1.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_difuse2.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_difuse3.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_difuse4.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_difuse5.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_difuse6.jpg',
      size: [4, 4, 4],
      shininess: 0
    },
    {
      texture: 'img/fendi_casa_conrad_reflect1.png',
      size: [4, 4, 4],
      shininess: 0
    },

    {
      texture: 'img/pattern_.jpg',
      size: [8, 8, 8],
      shininess: 10
    },

    {
      texture: 'img/denim_.jpg',
      size: [3, 3, 3],
      shininess: 0
    },

    {
      texture: 'img/quilt_.jpg',
      size: [6, 6, 6],
      shininess: 0
    },

  ];



  const modelViewerTexture1 = document.querySelector("model-viewer#helmet");
  // modelViewerTexture1.style.height = (screen.availHeight - 160).toString() +"px"

  modelViewerTexture1.addEventListener("load", () => {


    const material = modelViewerTexture1.model.materials[0];
    console.log(modelViewerTexture1.model)

    const createAndApplyTexture = async (channel, color) => {
      const texture = await modelViewerTexture1.createTexture(color.texture);
      if (channel.includes('base') || channel.includes('metallic')) {
        material.pbrMetallicRoughness[channel].setTexture(texture);
      } else {
        material[channel].setTexture(texture);
      }
    }

    for (const swatch of swatches) {
      swatch.addEventListener('click', selectSwatch);
    }

    function selectSwatch(e) {
      console.log("dgdgdsfgdfsgdsgdsr", e.target.dataset.key)
      let color = colors[parseInt(e.target.dataset.key)];
      console.log(color)
      createAndApplyTexture('baseColorTexture', color);

    }

    // document.querySelector('#normals').addEventListener('input', (event) => {
    // createAndApplyTexture('normalTexture', event);
    // });

    // document.querySelector('#occlusion').addEventListener('input', (event) => {
    //   createAndApplyTexture('occlusionTexture', event);
    // });

    // document.querySelector('#emission').addEventListener('input', (event) => {
    //   createAndApplyTexture('emissiveTexture', event);
    // });

    // document.querySelector('#diffuse').addEventListener('input', (event) => {
    //   createAndApplyTexture('baseColorTexture', event);
    // });

    // document.querySelector('#metallicRoughness').addEventListener('input', (event) => {
    //   createAndApplyTexture('metallicRoughnessTexture', event);
    // });
  });


  function buildColors(colors) {
    console.log("dfgsdfgh")
    for (let [i, color] of colors.entries()) {
      let swatch = document.createElement('div');
      swatch.classList.add('tray__swatch');

      if (color.texture) {
        swatch.style.backgroundImage = "url(" + color.texture + ")";
      } else {
        swatch.style.background = "#" + color.color;
      }

      swatch.setAttribute('data-key', i);
      TRAY.append(swatch);
    }
  }

  buildColors(colors);

  const swatches = document.querySelectorAll(".tray__swatch");

  for (const swatch of swatches) {
    swatch.addEventListener('click', selectSwatch);
  }

  function selectSwatch(e) {
    let color = colors[parseInt(e.target.dataset.key)];
    createAndApplyTexture('normalTexture', color);
  }


  var slider = document.getElementById('js-tray'), sliderItems = document.getElementById('js-tray-slide'), difference;

  function slide(wrapper, items) {
    var posX1 = 0,
      posX2 = 0,
      posInitial,
      threshold = 20,
      posFinal,
      slides = items.getElementsByClassName('tray__swatch');

    // Mouse events
    items.onmousedown = dragStart;

    // Touch events
    items.addEventListener('touchstart', dragStart);
    items.addEventListener('touchend', dragEnd);
    items.addEventListener('touchmove', dragAction);


    function dragStart(e) {
      e = e || window.event;
      posInitial = items.offsetLeft;
      difference = sliderItems.offsetWidth - slider.offsetWidth;
      difference = difference * -1;

      if (e.type == 'touchstart') {
        posX1 = e.touches[0].clientX;
      } else {
        posX1 = e.clientX;
        document.onmouseup = dragEnd;
        document.onmousemove = dragAction;
      }
    }

    function dragAction(e) {
      e = e || window.event;

      if (e.type == 'touchmove') {
        posX2 = posX1 - e.touches[0].clientX;
        posX1 = e.touches[0].clientX;
      } else {
        posX2 = posX1 - e.clientX;
        posX1 = e.clientX;
      }

      if (items.offsetLeft - posX2 <= 0 && items.offsetLeft - posX2 >= difference) {
        items.style.left = items.offsetLeft - posX2 + "px";
      }
    }

    function dragEnd(e) {
      posFinal = items.offsetLeft;
      if (posFinal - posInitial < -threshold) {

      } else if (posFinal - posInitial > threshold) {

      } else {
        items.style.left = posInitial + "px";
      }

      document.onmouseup = null;
      document.onmousemove = null;
    }

  }

  slide(slider, sliderItems);
</script>